<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ìƒí’ˆ ëª©ë¡ - ê²½ë§¤ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }
        
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">ğŸ”¨ ê²½ë§¤ ì‹œìŠ¤í…œ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">í™ˆ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="product-register.html">ìƒí’ˆ ë“±ë¡</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="product-list.html">ë‚´ ìƒí’ˆ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-box-seam"></i> ë‚´ ìƒí’ˆ ëª©ë¡</h2>
                    <a href="product-register.html" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> ìƒˆ ìƒí’ˆ ë“±ë¡
                    </a>
                </div>

                <!-- í•„í„° -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                                <select class="form-select" id="filterCategory">
                                    <option value="">ì „ì²´</option>
                                    <option value="ELECTRONICS">ì „ìì œí’ˆ</option>
                                    <option value="CLOTHING">ì˜ë¥˜</option>
                                    <option value="BOOKS">ë„ì„œ</option>
                                    <option value="HOME_APPLIANCES">ê°€ì „ì œí’ˆ</option>
                                    <option value="SPORTS">ìŠ¤í¬ì¸ </option>
                                    <option value="ETC">ê¸°íƒ€</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">ìƒíƒœ</label>
                                <select class="form-select" id="filterStatus">
                                    <option value="">ì „ì²´</option>
                                    <option value="DRAFT">ì„ì‹œì €ì¥</option>
                                    <option value="REGISTERED">ê²½ë§¤ ë“±ë¡ë¨</option>
                                    <option value="SOLD">íŒë§¤ ì™„ë£Œ</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">ê²€ìƒ‰</label>
                                <input type="text" class="form-control" id="searchKeyword" placeholder="ìƒí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="loadProducts()">
                                    <i class="bi bi-search"></i> ê²€ìƒ‰
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìƒí’ˆ ëª©ë¡ -->
                <div id="productListContainer">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        let currentUser = null;

        window.addEventListener('DOMContentLoaded', () => {
            currentUser = getCurrentUser();
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            loadProducts();
        });

        async function loadProducts() {
            const container = document.getElementById('productListContainer');
            
            try {
                const category = document.getElementById('filterCategory').value;
                const status = document.getElementById('filterStatus').value;
                const keyword = document.getElementById('searchKeyword').value;

                const response = await api.get(`/api/v1/products/seller/${currentUser.userId}`, {
                    params: {
                        category: category || undefined,
                        status: status || undefined,
                        keyword: keyword || undefined
                    },
                    headers: {
                        'X-User-Id': currentUser.userId
                    }
                });

                if (response.data.success) {
                    displayProducts(response.data.data);
                } else {
                    throw new Error('ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Load products error:', error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> 
                        ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('productListContainer');
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-inbox" style="font-size: 4rem; color: #dee2e6;"></i>
                        <p class="mt-3 text-muted">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <a href="product-register.html" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> ì²« ìƒí’ˆ ë“±ë¡í•˜ê¸°
                        </a>
                    </div>
                `;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'product-grid';

            products.forEach(product => {
                const card = createProductCard(product);
                grid.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        function createProductCard(product) {
            const div = document.createElement('div');
            
            const statusClass = {
                'DRAFT': 'bg-secondary',
                'REGISTERED': 'bg-success',
                'SOLD': 'bg-info',
                'DELETED': 'bg-danger'
            }[product.status] || 'bg-secondary';

            const statusText = {
                'DRAFT': 'ì„ì‹œì €ì¥',
                'REGISTERED': 'ê²½ë§¤ ë“±ë¡ë¨',
                'SOLD': 'íŒë§¤ ì™„ë£Œ',
                'DELETED': 'ì‚­ì œë¨'
            }[product.status] || product.status;

            const conditionText = {
                'NEW': 'ìƒˆ ìƒí’ˆ',
                'USED_GOOD': 'ì¤‘ê³  - ìƒíƒœ ì¢‹ìŒ',
                'USED_BAD': 'ì¤‘ê³  - ì‚¬ìš©ê° ìˆìŒ'
            }[product.condition] || product.condition;

            const thumbnailUrl = product.images && product.images.length > 0 
                ? product.images[0].imageUrl 
                : 'https://via.placeholder.com/300x200?text=No+Image';

            div.innerHTML = `
                <div class="card product-card" onclick="viewProduct(${product.id})">
                    <div class="position-relative">
                        <img src="${thumbnailUrl}" class="product-image" alt="${product.title}">
                        <span class="badge ${statusClass} status-badge">${statusText}</span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-truncate">${product.title}</h5>
                        <p class="card-text text-muted small mb-2">
                            <i class="bi bi-tag"></i> ${getCategoryName(product.category)} Â· ${conditionText}
                        </p>
                        <p class="card-text text-truncate">${product.description}</p>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                <i class="bi bi-clock"></i> ${formatDate(product.createdAt)}
                            </small>
                            <div>
                                ${product.status === 'DRAFT' ? `
                                    <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); createAuction(${product.id})">
                                        <i class="bi bi-arrow-right-circle"></i> ê²½ë§¤ ë“±ë¡
                                    </button>
                                ` : ''}
                                <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteProduct(${product.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return div;
        }

        function getCategoryName(category) {
            const names = {
                'ELECTRONICS': 'ì „ìì œí’ˆ',
                'CLOTHING': 'ì˜ë¥˜',
                'BOOKS': 'ë„ì„œ',
                'HOME_APPLIANCES': 'ê°€ì „ì œí’ˆ',
                'SPORTS': 'ìŠ¤í¬ì¸ ',
                'ETC': 'ê¸°íƒ€'
            };
            return names[category] || category;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return `${minutes}ë¶„ ì „`;
            if (hours < 24) return `${hours}ì‹œê°„ ì „`;
            if (days < 7) return `${days}ì¼ ì „`;
            
            return date.toLocaleDateString('ko-KR');
        }

        function viewProduct(productId) {
            window.location.href = `product-detail.html?id=${productId}`;
        }

        async function deleteProduct(productId) {
            if (!confirm('ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await api.delete(`/api/v1/products/${productId}`, {
                    headers: {
                        'X-User-Id': currentUser.userId
                    }
                });

                if (response.data.success) {
                    alert('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadProducts();
                } else {
                    throw new Error('ìƒí’ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Delete product error:', error);
                alert(error.response?.data?.error?.message || 'ìƒí’ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function createAuction(productId) {
            window.location.href = `auction-create.html?productId=${productId}`;
        }

        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>

