<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ë§¤ ë¬¼í’ˆ ë“±ë¡ - ê²½ë§¤ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .create-container {
            max-width: 800px;
            margin: 50px auto;
        }
        .form-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        .form-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .form-header h2 {
            color: #667eea;
            font-weight: bold;
        }
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .btn-submit:hover {
            opacity: 0.9;
            color: white;
        }
        .required-mark {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">ğŸ† ê²½ë§¤ ì‹œìŠ¤í…œ</a>
            <div class="d-flex align-items-center">
                <span class="text-white me-3">
                    <i class="bi bi-wallet2"></i> 
                    <span id="userPoint">0</span>ì›
                </span>
                <button class="btn btn-light btn-sm me-2" onclick="location.href='index.html'">
                    <i class="bi bi-house"></i> í™ˆ
                </button>
                <button class="btn btn-light btn-sm me-2" onclick="location.href='mypage.html'">
                    <i class="bi bi-person-circle"></i> ë§ˆì´í˜ì´ì§€
                </button>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </nav>

    <div class="create-container">
        <div class="form-card">
            <div class="form-header">
                <h2>
                    <i class="bi bi-plus-circle"></i> ê²½ë§¤ ë¬¼í’ˆ ë“±ë¡
                </h2>
                <p class="text-muted">íŒë§¤í•˜ì‹¤ ë¬¼í’ˆ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            </div>

            <form id="createAuctionForm">
                <!-- ì œëª© -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        ì œëª© <span class="required-mark">*</span>
                    </label>
                    <input type="text" class="form-control form-control-lg" id="title" 
                           placeholder="ê²½ë§¤ ë¬¼í’ˆì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required maxlength="100">
                    <small class="text-muted">ìµœëŒ€ 100ì</small>
                </div>

                <!-- ì‹œì‘ê°€ -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        ì‹œì‘ê°€ <span class="required-mark">*</span>
                    </label>
                    <div class="input-group input-group-lg">
                        <input type="number" class="form-control" id="startPrice" 
                               placeholder="1000" required min="1000" step="1000">
                        <span class="input-group-text">ì›</span>
                    </div>
                    <small class="text-muted">ìµœì†Œ 1,000ì›ë¶€í„° ì…ì°° ê°€ëŠ¥í•©ë‹ˆë‹¤</small>
                </div>

                <!-- ê²½ë§¤ ì‹œì‘ ì‹œê°„ -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        ê²½ë§¤ ì‹œì‘ ì‹œê°„ <span class="required-mark">*</span>
                    </label>
                    <input type="datetime-local" class="form-control form-control-lg" 
                           id="startTime" required>
                    <small class="text-muted">í˜„ì¬ ì‹œê°„ ì´í›„ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”</small>
                </div>

                <!-- ê²½ë§¤ ì¢…ë£Œ ì‹œê°„ -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        ê²½ë§¤ ì¢…ë£Œ ì‹œê°„ <span class="required-mark">*</span>
                    </label>
                    <input type="datetime-local" class="form-control form-control-lg" 
                           id="endTime" required>
                    <small class="text-muted">ì‹œì‘ ì‹œê°„ë³´ë‹¤ ìµœì†Œ 1ì‹œê°„ ì´í›„ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”</small>
                </div>

                <!-- ë¹ ë¥¸ ì„¤ì • ë²„íŠ¼ë“¤ -->
                <div class="mb-4">
                    <label class="form-label fw-bold">ë¹ ë¥¸ ê¸°ê°„ ì„¤ì •</label>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-secondary" onclick="setQuickDuration(1)">
                            1ì¼
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setQuickDuration(3)">
                            3ì¼
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setQuickDuration(7)">
                            7ì¼
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setQuickDuration(14)">
                            14ì¼
                        </button>
                    </div>
                </div>

                <!-- ì£¼ì˜ì‚¬í•­ -->
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    <strong>ì£¼ì˜ì‚¬í•­</strong>
                    <ul class="mb-0 mt-2">
                        <li>ê²½ë§¤ ë“±ë¡ í›„ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                        <li>ê²½ë§¤ ì‹œì‘ ì „ê¹Œì§€ ì‚­ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                        <li>í—ˆìœ„ ë¬¼í’ˆ ë“±ë¡ ì‹œ ê³„ì •ì´ ì •ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    </ul>
                </div>

                <!-- ì œì¶œ ë²„íŠ¼ -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-submit">
                        <i class="bi bi-check-circle"></i> ê²½ë§¤ ë“±ë¡í•˜ê¸°
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ì²´í¬
        if (!requireLogin()) {
            // requireLoginì´ falseë¥¼ ë°˜í™˜í•˜ë©´ ì—¬ê¸°ì„œ ì¤‘ë‹¨
        }

        // ì‚¬ìš©ì í¬ì¸íŠ¸ ë¡œë“œ
        async function loadUserPoint() {
            try {
                const response = await UserAPI.getMyInfo();
                if (response.data.success) {
                    const point = response.data.data.totalPoint || 0;
                    document.getElementById('userPoint').textContent = formatPrice(point).replace('ì›', '');
                }
            } catch (error) {
                console.error('Failed to load user point:', error);
            }
        }

        // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì´ˆê¸°í™”
        function initializeDateTime() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            
            // ì‹œì‘ ì‹œê°„: í˜„ì¬ ì‹œê°„ + 10ë¶„
            const startTime = new Date(now.getTime() + 10 * 60000);
            document.getElementById('startTime').value = startTime.toISOString().slice(0, 16);
            
            // ì¢…ë£Œ ì‹œê°„: ì‹œì‘ ì‹œê°„ + 3ì¼
            const endTime = new Date(startTime.getTime() + 3 * 24 * 60 * 60000);
            document.getElementById('endTime').value = endTime.toISOString().slice(0, 16);
        }

        // ë¹ ë¥¸ ê¸°ê°„ ì„¤ì •
        function setQuickDuration(days) {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            
            // ì‹œì‘ ì‹œê°„: í˜„ì¬ ì‹œê°„
            const startTime = new Date(now.getTime());
            document.getElementById('startTime').value = startTime.toISOString().slice(0, 16);
            
            // ì¢…ë£Œ ì‹œê°„: ì‹œì‘ ì‹œê°„ + daysì¼
            const endTime = new Date(startTime.getTime() + days * 24 * 60 * 60000);
            document.getElementById('endTime').value = endTime.toISOString().slice(0, 16);
        }

        // ê²½ë§¤ ë“±ë¡ í¼ ì œì¶œ
        document.getElementById('createAuctionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('title').value;
            const startPrice = parseInt(document.getElementById('startPrice').value);
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (startPrice < 1000) {
                alert('ì‹œì‘ê°€ëŠ” ìµœì†Œ 1,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const startDate = new Date(startTime);
            const endDate = new Date(endTime);
            const now = new Date();
            
            if (startDate < now) {
                alert('ì‹œì‘ ì‹œê°„ì€ í˜„ì¬ ì‹œê°„ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (endDate <= startDate) {
                alert('ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const duration = (endDate - startDate) / (1000 * 60 * 60); // ì‹œê°„ ë‹¨ìœ„
            if (duration < 1) {
                alert('ê²½ë§¤ ê¸°ê°„ì€ ìµœì†Œ 1ì‹œê°„ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ê²½ë§¤ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në“±ë¡ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                const response = await api.post('/api/v1/seller/auctions', {
                    title,
                    startPrice,
                    startTime,
                    endTime
                });
                
                if (response.data.success) {
                    const auctionId = response.data.data;
                    alert('ê²½ë§¤ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    location.href = `detail.html?id=${auctionId}`;
                } else {
                    alert(response.data.message || 'ê²½ë§¤ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Create auction error:', error);
                const errorMessage = error.response?.data?.message || 'ê²½ë§¤ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                alert(errorMessage);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            loadUserPoint();
            initializeDateTime();
        });
    </script>
</body>
</html>

